{% include 'admin/header.html' %}
<!-- Article template -->
<script type="text/template" id="articles_list_template">
  <table class="table table-condensed">
    <thead>
      <tr>
        <th>#</th>
        <th>Title</th>
        <th>Date</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% _.each(articles, function (article) { %>
        <tr>
          <th scope="row"><%= article.id %></th>
          <td><%= article.title %></td>
          <td><%= article.date_creation %></td>
          <td><% if( article.status ){ %>publié<% }else{ %>En attente<% } %></td>
          <td><a href="/admin/article-edit/<%= article.id %>"><i class="fa fa-pencil-square-o"></i></a> | <a href="/admin/article-delete/<%= article.id %>" class="delete"><i class="fa fa-trash" aria-hidden="true"></i></a></td>
        </tr>
      <% }); %>
    </tbody>
  </table>
  <div class="clearfix"></div>
  <div class="pull-left">
    <a href="{{ path( 'adminarticles' ) }}" class="btn btn-primary"><i class="fa fa-circle-o-notch" aria-hidden="true"></i> Older posts</a>
  </div>
  <div class="pull-right">
    <a href="{{ path( 'adminarticlesadd' ) }}" class="btn"><i class="fa fa-plus" aria-hidden="true"></i> Nouvel article</a>
  </div>
  <div class="clearfix"></div>
</script>
{% include 'admin/scripts.html' %}
<script>
  /*******************************/
  /*******  Articles List  ********/
  /*******************************/
  var ArtilcesList = Backbone.View.extend({
    el: $("#main_content"),
    offset: 0,

    initialize: function(){
      this.articles = new Articles;
      this.loadArticles();
      _.bindAll( this, 'render' );
      this.articles.bind( 'change', this.render );
      this.articles.bind( 'add', this.render );
      this.render();
    },

    events: {
      "click a.delete": "confirmDelete",
      "click .pull-left .btn-primary": "loadArticlesEvent"
    },

    loadArticlesEvent:function(event) {
      event.preventDefault();
      this.loadArticles();
    },

    loadArticles: function() {
      App.animateBtn();
      this.articles.fetch({
        data: $.param({ offset: this.offset}),
        success: function(){
          App.animateResponse('Articles chargés');
        }
      });
      this.offset++;
    },

    confirmDelete: function(event) {
      if( !confirm("Tu es sur ?") ) {
          event.preventDefault();
      }
    },

    render: function(){
      var template = _.template( $("#articles_list_template").html() );
      this.$el.html( template( { articles: this.articles.toJSON() } ) );
    },

  });

  var Article = Backbone.Model.extend({
    url: '/admin/article/',

    initialize: function() {
      console.log('Here init article model ' + this.url);
    }

  });

  var Articles = Backbone.Collection.extend({
    url: '/admin/articles',
    model: Article
  });


  var article_list = new ArtilcesList;

</script>
{% include 'admin/footer.html' %}